<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>St√§rke Merge Battle</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #1e1e2f;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding-top: 20px;
    }
    #game {
      display: flex;
      gap: 15px;
      margin: 20px 0;
      flex-wrap: wrap;
      justify-content: center;
    }
    .enemy, .item, .boss {
      background: #333;
      padding: 20px;
      border-radius: 10px;
      cursor: pointer;
      text-align: center;
      transition: transform 0.2s;
      width: 100px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
    .enemy:hover, .item:hover, .boss:hover {
      transform: scale(1.1);
      background: #444;
    }
    .dead {
      opacity: 0.4;
      pointer-events: none;
    }
    .x2 { background: #2e8b57; color: #fff; font-weight: bold; }
    .minus5 { background: #8b0000; color: #fff; font-weight: bold; }
    .random { background: #1e90ff; color: #fff; font-weight: bold; }
    .boss { background: #ff8c00; color: black; font-weight: bold; border: 2px solid gold; }
    #log {
      max-height: 200px;
      overflow-y: auto;
      background: #111;
      padding: 10px;
      width: 300px;
      border-radius: 5px;
      box-shadow: inset 0 0 10px #000;
    }
    button {
      margin-top: 10px;
      padding: 10px 20px;
      border: none;
      background: #444;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      box-shadow: 0 0 5px rgba(255,255,255,0.2);
    }
    button:hover {
      background: #666;
    }
    #stats {
      margin-top: 20px;
      color: #ccc;
    }
  </style>
</head>
<body>
  <h1>St√§rke Merge Battle</h1>
  <h2>Level: <span id="levelNumber">1</span></h2>
  <h3 id="debuffText"></h3>
  <p>Deine St√§rke: <span id="playerLevel">5</span></p>
  <div id="game"></div>
  <div id="log"></div>
  <button id="nextLevelBtn" style="display:none;">N√§chstes Level starten</button>
  <div id="stats"></div>

  <script>
    let level = 1;
    let playerLevel = 5;
    let basePlayerLevel = 5;
    let debuff = 0;
    let enemies = [];
    let bossMode = false;
    let bossPhase = 0;
    let bossTargetLevel = Math.floor(Math.random() * 10) + 1;
    let totalEnemyStrength = 0;

    let stats = {
      levelBeendet: 0,
      powerupsGenutzt: 0,
      fallenGetroffen: 0,
      zufallGenutzt: 0,
      bosseBesiegt: 0
    };

    const gameDiv = document.getElementById('game');
    const playerLevelSpan = document.getElementById('playerLevel');
    const logDiv = document.getElementById('log');
    const levelNumberSpan = document.getElementById('levelNumber');
    const nextLevelBtn = document.getElementById('nextLevelBtn');
    const statsDiv = document.getElementById('stats');
    const debuffText = document.getElementById('debuffText');

    function log(msg) {
      logDiv.innerHTML += `<div>${msg}</div>`;
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }

    function updateUI() {
      gameDiv.innerHTML = '';
      enemies.forEach(e => {
        const btn = document.createElement('div');
        btn.className = e.type;
        if (e.dead) btn.classList.add('dead');
        btn.classList.add(e.effect === 'x2' ? 'x2' : e.effect === '-5' ? 'minus5' : e.effect === 'random' ? 'random' : '');
        btn.innerText = e.type === 'enemy' || e.type === 'boss' ? `St√§rke ${e.level}` : e.effect.toUpperCase();
        btn.onclick = () => handleClick(e);
        gameDiv.appendChild(btn);
      });
      playerLevelSpan.textContent = playerLevel;
      levelNumberSpan.textContent = level;
      debuffText.textContent = debuff > 0 ? `‚ö†Ô∏è Ersch√∂pfung: -${debuff} St√§rke` : '';
    }

    function handleClick(entity) {
      if (entity.dead) return;

      if (entity.type === 'enemy' || entity.type === 'boss') {
        if (playerLevel > entity.level) {
          playerLevel += entity.level;
          log(`üó°Ô∏è Besiegt! Neue St√§rke: ${playerLevel}`);
          entity.dead = true;
        } else {
          log(`üíÄ Verloren gegen Gegner mit ${entity.level}.`);
          if (entity.type === 'boss') {
            debuff = Math.min(debuff + 1, 5);
            log(`‚ùå Bosskampf verloren. Debuff erh√∂ht auf -${debuff} St√§rke.`);
            startLevel();
          } else {
            log(`‚ò†Ô∏è Game Over!`);
            gameDiv.innerHTML = '<h2>Game Over</h2>';
            return;
          }
        }
      } else if (entity.type === 'item') {
        if (entity.effect === 'x2') {
          playerLevel *= 2;
          stats.powerupsGenutzt++;
          log(`‚ö° Powerup aktiviert! St√§rke verdoppelt: ${playerLevel}`);
        } else if (entity.effect === '-5') {
          if (playerLevel <= 5) {
            log(`üíÄ Falle war t√∂dlich. Game Over.`);
            gameDiv.innerHTML = '<h2>Game Over</h2>';
            return;
          } else {
            playerLevel -= 5;
            stats.fallenGetroffen++;
            log(`‚ö†Ô∏è -5 Falle getroffen. Neue St√§rke: ${playerLevel}`);
          }
        } else if (entity.effect === 'random') {
          const change = Math.floor(Math.random() * 11) - 5;
          playerLevel += change;
          stats.zufallGenutzt++;
          log(`üé≤ Zufallseffekt: ${change >= 0 ? '+' : ''}${change}. Neue St√§rke: ${playerLevel}`);
        }
        entity.dead = true;
      }

      updateUI();
      checkLevelCompletion();
    }

    function checkLevelCompletion() {
      if (enemies.every(e => e.dead || (!e.required && e.type === 'item'))) {
        nextLevelBtn.style.display = 'block';
      }
    }

    function startLevel() {
      nextLevelBtn.style.display = 'none';
      playerLevel = basePlayerLevel - debuff;
      if (level === bossTargetLevel) {
        bossMode = true;
        bossPhase = 0;
        totalEnemyStrength = 0;
        enemies = generateBossWave();
      } else {
        function generateEnemies(level) {
  const base = basePlayerLevel - debuff;
  const count = 3 + Math.floor(Math.random() * 3);
  let list = [];
  let ensureWeaker = debuff < 3;

  for (let i = 0; i < count; i++) {
    let val = Math.floor(base * 0.8 + Math.random() * (level * 2));
    list.push({ type: 'enemy', level: val });
  }

  if (ensureWeaker && !list.some(e => e.level < base)) {
    list[0].level = Math.max(0, base - 1);
  }

  if (Math.random() < 0.2) list.push({ type: 'item', effect: 'x2', required: false });
  if (Math.random() < 0.4) list.push({ type: 'item', effect: '-5', required: true });
  if (Math.random() < 0.3) list.push({ type: 'item', effect: 'random', required: false });

  shuffleArray(list);
  list.forEach((e, i) => e.id = i);
  return list;
}
      }
      updateUI();
    }

    function generateBossWave() {
      const phaseCount = Math.floor(Math.random() * 3) + 3;
      const wave = [];
      if (bossPhase < phaseCount - 1) {
        const count = 3 + Math.floor(Math.random() * 3);
        let valid = false;
        while (!valid) {
          wave.length = 0;
          for (let i = 0; i < count; i++) {
            let str = Math.floor(playerLevel * 0.6 + Math.random() * 5);
            wave.push({ type: 'enemy', level: str });
          }
          valid = wave.some(e => e.level < playerLevel);
        }
        wave.forEach(e => totalEnemyStrength += e.level);
        bossPhase++;
      } else {
        const factor = 0.95 + Math.random() * 0.1;
        const bossStrength = Math.round(totalEnemyStrength * factor);
        wave.push({ type: 'boss', level: bossStrength });
        log(`<strong>‚öîÔ∏è Der Boss erscheint! St√§rke ${bossStrength}</strong>`);
        bossMode = false;
        totalEnemyStrength = 0;
      }
      wave.forEach((e, i) => e.id = `b${bossPhase}-${i}`);
      return wave;
    }

    function generateEnemies(level) {
      const base = basePlayerLevel - debuff;
      const count = 3 + Math.floor(Math.random() * 3);
      let list = [];
      let ensureWeaker = debuff < 3;

      for (let i = 0; i < count; i++) {
        let val = Math.floor(base * 0.8 + Math.random() * (level * 2));
        list.push({ type: 'enemy', level: val });
      }

      if (ensureWeaker && !list.some(e => e.level < base)) {
        list[0].level = Math.max(0, base - 1);
      }

      if (Math.random() < 0.2) list.push({ type: 'item', effect: 'x2', required: false });
      if (Math.random() < 0.4) list.push({ type: 'item', effect: '-5', required: true });
      if (Math.random() < 0.3) list.push({ type: 'item', effect: 'random', required: false });

      shuffleArray(list);
      list.forEach((e, i) => e.id = i);
      return list;
    }

    nextLevelBtn.onclick = () => {
      if (!bossMode && level === bossTargetLevel) {
        bossMode = true;
        bossPhase = 0;
        totalEnemyStrength = 0;
      } else {
        level++;
      }

      if (!bossMode) {
        stats.levelBeendet++;
      }

      if (debuff > 0 && !bossMode) {
        log(`<strong>üß† Du spielst unter Ersch√∂pfung (-${debuff} St√§rke).</strong>`);
      }

      startLevel();
      statsDiv.innerHTML = `
        <p>Level beendet: ${stats.levelBeendet}</p>
        <p>Powerups genutzt: ${stats.powerupsGenutzt}</p>
        <p>Fallen getroffen: ${stats.fallenGetroffen}</p>
        <p>Zufall genutzt: ${stats.zufallGenutzt}</p>
        <p>Bosse besiegt: ${stats.bosseBesiegt}</p>
      `;
    };

    startLevel();
  </script>
</body>
</html>
