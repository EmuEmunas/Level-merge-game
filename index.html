<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>St√§rke Merge Battle</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #1e1e2f;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding-top: 20px;
    }
    h1, h2 {
      margin: 5px;
    }
    #game {
      display: flex;
      gap: 15px;
      margin: 20px 0;
      flex-wrap: wrap;
      justify-content: center;
    }
    .enemy, .item, .boss {
      background: #333;
      padding: 20px;
      border-radius: 10px;
      cursor: pointer;
      text-align: center;
      transition: transform 0.2s;
      width: 100px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
    .enemy:hover, .item:hover, .boss:hover {
      transform: scale(1.1);
      background: #444;
    }
    .dead {
      opacity: 0.4;
      pointer-events: none;
    }
    .x2 { background: #2e8b57; color: #fff; font-weight: bold; }
    .minus5 { background: #8b0000; color: #fff; font-weight: bold; }
    .random { background: #1e90ff; color: #fff; font-weight: bold; }
    .boss { background: #ff8c00; color: black; font-weight: bold; border: 2px solid gold; }
    #log {
      max-height: 200px;
      overflow-y: auto;
      background: #111;
      padding: 10px;
      width: 300px;
      border-radius: 5px;
      box-shadow: inset 0 0 10px #000;
    }
    button {
      margin-top: 10px;
      padding: 10px 20px;
      border: none;
      background: #444;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      box-shadow: 0 0 5px rgba(255,255,255,0.2);
    }
    button:hover {
      background: #666;
    }
    #stats {
      margin-top: 20px;
      color: #ccc;
    }
  </style>
</head>
<body>
  <h1>St√§rke Merge Battle</h1>
  <h2>Level: <span id="levelNumber">1</span></h2>
  <p>Deine St√§rke: <span id="playerLevel">5</span></p>
  <div id="game"></div>
  <div id="log"></div>
  <button id="nextLevelBtn" style="display:none;">N√§chstes Level starten</button>
  <div id="stats"></div>  <script>
    let level = 1;
    let playerLevel = 5;
    let enemies = [];
    let bossMode = false;
    let bossPhase = 0;
    let bossTargetLevel = Math.floor(Math.random() * 10) + 1; // Zuf√§llig zw. 1‚Äì10

    let stats = {
      levelBeendet: 0,
      bonusGenutzt: 0,
      fallenGetroffen: 0,
      zufallGenutzt: 0
    };

    const gameDiv = document.getElementById('game');
    const playerLevelSpan = document.getElementById('playerLevel');
    const logDiv = document.getElementById('log');
    const levelNumberSpan = document.getElementById('levelNumber');
    const nextLevelBtn = document.getElementById('nextLevelBtn');
    const statsDiv = document.getElementById('stats');

    function log(msg) {
      logDiv.innerHTML += `<div>${msg}</div>`;
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }

    function generateBossWave() {
      const phaseCount = Math.floor(Math.random() * 3) + 3; // 3‚Äì5 Phasen
      const wave = [];
      if (bossPhase < phaseCount - 1) {
        const count = 3 + Math.floor(Math.random() * 3);
        for (let i = 0; i < count; i++) {
          wave.push({ id: `b-${bossPhase}-${i}`, type: 'enemy', level: Math.round(playerLevel * 0.7 + Math.random() * 5) });
        }
        bossPhase++;
      } else {
        wave.push({ id: 'final-boss', type: 'boss', level: Math.round(playerLevel * 1.3 + 10) });
        log(`<strong>‚öîÔ∏è Der Boss erscheint!</strong>`);
        bossMode = false; // Bosskampf ist abgeschlossen nach dieser Phase
      }
      return wave;
    }

    function generateEnemies(level) {
      const basePlayer = 5;
      const numberOfEnemies = 5 + Math.floor(level / 2);
      const path = [];
      let currentStrength = basePlayer;

      for (let i = 0; i < numberOfEnemies; i++) {
        const enemyStrength = Math.round(Math.floor(Math.random() * 3) + Math.floor(currentStrength * 0.5));
        path.push({ id: i + 1, type: 'enemy', level: enemyStrength });
        currentStrength += enemyStrength;
      }

      if (Math.random() < 0.6) path.splice(Math.floor(Math.random() * path.length), 0, { id: 'x2', type: 'item', effect: 'x2', required: true });
      if (Math.random() < 0.4) path.splice(Math.floor(Math.random() * path.length), 0, { id: 'minus5', type: 'item', effect: '-5', required: true });
      if (Math.random() < 0.3) path.splice(Math.floor(Math.random() * path.length), 0, { id: 'random', type: 'item', effect: 'random', required: false });

      shuffleArray(path);
      return path;
    }

    function render() {
      gameDiv.innerHTML = '';
      enemies.forEach(enemy => {
        const div = document.createElement('div');
        div.className = enemy.type;
        if (enemy.defeated) div.classList.add('dead');
        div.textContent = enemy.type === 'boss' ? `üß† BOSS\n??` : enemy.type === 'enemy' ? `Gegner\nSt√§rke ${enemy.level}` : '';
        div.title = enemy.type === 'boss' ? 'Endgegner ‚Äì unbekannte St√§rke!' : 'Greife nur an, wenn du st√§rker bist!';

        if (enemy.type === 'enemy' || enemy.type === 'boss') {
          div.onclick = () => fight(enemy);
        } else if (enemy.type === 'item') {
          if (enemy.effect === 'x2') {
            div.classList.add('x2');
            div.textContent = 'Bonus x2';
            div.title = 'Verdoppelt deine aktuelle St√§rke';
            div.onclick = () => {
              log(`Du sammelst Bonus x2! Deine St√§rke verdoppelt sich.`);
              playerLevel *= 2;
              enemy.defeated = true;
              stats.bonusGenutzt++;
              render();
              checkLevelComplete();
            };
          } else if (enemy.effect === '-5') {
            div.classList.add('minus5');
            div.textContent = '-5 Falle';
            div.title = 'Verringert deine St√§rke um 5';
            div.onclick = () => {
              if (playerLevel <= 5) {
                log(`Du verlierst 5 St√§rke, aber hattest nur ${playerLevel}. Du verlierst.`);
                alert("Game Over!");
                location.reload();
                return;
              }
              log(`Du trittst in eine Falle! -5 St√§rke.`);
              playerLevel -= 5;
              stats.fallenGetroffen++;
              enemy.defeated = true;
              render();
              checkLevelComplete();
            };
          } else if (enemy.effect === 'random') {
            div.classList.add('random');
            div.textContent = 'Zufall';
            div.title = 'Kann deine St√§rke √§ndern ‚Äì positiv, negativ oder gar nicht';
            div.onclick = () => {
              const rnd = Math.random();
              stats.zufallGenutzt++;
              if (rnd < 0.33) {
                log(`Zufall! Deine St√§rke wird halbiert.`);
                playerLevel = Math.floor(playerLevel / 2);
              } else if (rnd < 0.66) {
                const gain = Math.floor(Math.random() * 10 + 1);
                log(`Zufall! Du bekommst ${gain} St√§rke dazu.`);
                playerLevel += gain;
              } else {
                log(`Zufall! Nichts passiert.`);
              }
              enemy.defeated = true;
              render();
              checkLevelComplete();
            };
          }
        }
        gameDiv.appendChild(div);
      });
      playerLevelSpan.textContent = playerLevel;
      levelNumberSpan.textContent = level;
    }

    function fight(enemy) {
      if (enemy.defeated) return;
      const strength = enemy.level || 0;
      if (playerLevel > strength) {
        log(`Du besiegst ${enemy.type === 'boss' ? 'den Boss!' : 'Gegner mit St√§rke ' + strength}.`);
        playerLevel += strength;
        enemy.defeated = true;
        render();
        checkLevelComplete();
      } else {
        log(`${enemy.type === 'boss' ? 'Der Boss' : 'Gegner'} mit St√§rke ${strength} ist zu stark oder gleich stark! Du verlierst.`);
        alert("Game Over!\n\nAbgeschlossene Level: " + stats.levelBeendet + "\nVerwendete x2-Boni: " + stats.bonusGenutzt + "\nGefallene Fallen: " + stats.fallenGetroffen + "\nZufall ausgel√∂st: " + stats.zufallGenutzt);
        location.reload();
      }
    }

    function checkLevelComplete() {
      const remaining = enemies.filter(e => !e.defeated);
      const allDone = remaining.every(e => e.type === 'item' && e.effect === 'random' && !e.required);
      if (remaining.length === 0 || allDone) {
        if (bossMode) {
          enemies = generateBossWave();
          render();
          return;
        }
        log(`<strong>Level ${level} abgeschlossen!</strong>`);
        stats.levelBeendet++;
        updateStats();
        nextLevelBtn.style.display = 'inline-block';
      }
    }

    function updateStats() {
      statsDiv.innerHTML = `
        <strong>Statistik:</strong><br>
        Abgeschlossene Level: ${stats.levelBeendet}<br>
        Verwendete x2-Boni: ${stats.bonusGenutzt}<br>
        Gefallene Fallen: ${stats.fallenGetroffen}<br>
        Zufall ausgel√∂st: ${stats.zufallGenutzt}<br>
      `;
    }

    function startLevel() {
      playerLevel = 5;
      bossPhase = 0;
      nextLevelBtn.style.display = 'none';
      log(`<em>Level ${level} beginnt.</em>`);
      if ((level - 1) % 10 === bossTargetLevel - 1) {
        log(`<strong>‚öîÔ∏è Bosskampf beginnt!</strong>`);
        bossMode = true;
        enemies = generateBossWave();
      } else {
        enemies = generateEnemies(level);
      }
      render();
    }

    nextLevelBtn.onclick = () => {
      level++;
      startLevel();
    }

    startLevel();
  </script></body>
</html>
