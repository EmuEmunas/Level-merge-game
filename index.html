<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stärke Merge Battle</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #1e1e2f;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding-top: 20px;
    }
    h1, h2 {
      margin: 5px;
    }
    #game {
      display: flex;
      gap: 15px;
      margin: 20px 0;
      flex-wrap: wrap;
      justify-content: center;
    }
    .enemy, .item {
      background: #333;
      padding: 20px;
      border-radius: 10px;
      cursor: pointer;
      text-align: center;
      transition: transform 0.2s;
      width: 100px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
    .enemy:hover, .item:hover {
      transform: scale(1.1);
      background: #444;
    }
    .dead {
      opacity: 0.4;
      pointer-events: none;
    }
    .x2 { background: #2e8b57; color: #fff; font-weight: bold; }
    .minus5 { background: #8b0000; color: #fff; font-weight: bold; }
    .random { background: #1e90ff; color: #fff; font-weight: bold; }
    #log {
      max-height: 200px;
      overflow-y: auto;
      background: #111;
      padding: 10px;
      width: 300px;
      border-radius: 5px;
      box-shadow: inset 0 0 10px #000;
    }
    button {
      margin-top: 10px;
      padding: 10px 20px;
      border: none;
      background: #444;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      box-shadow: 0 0 5px rgba(255,255,255,0.2);
    }
    button:hover {
      background: #666;
    }
    #stats {
      margin-top: 20px;
      color: #ccc;
    }
  </style>
</head>
<body>
  <h1>Stärke Merge Battle</h1>
  <h2>Level: <span id="levelNumber">1</span></h2>
  <p>Deine Stärke: <span id="playerLevel">5</span></p>
  <div id="game"></div>
  <div id="log"></div>
  <button id="nextLevelBtn" style="display:none;">Nächstes Level starten</button>
  <div id="stats"></div>  <script>
    let level = 1;
    let playerLevel = 5;
    let enemies = [];
    let stats = {
      levelBeendet: 0,
      bonusGenutzt: 0,
      fallenGetroffen: 0,
      zufallGenutzt: 0
    };

    const gameDiv = document.getElementById('game');
    const playerLevelSpan = document.getElementById('playerLevel');
    const logDiv = document.getElementById('log');
    const levelNumberSpan = document.getElementById('levelNumber');
    const nextLevelBtn = document.getElementById('nextLevelBtn');
    const statsDiv = document.getElementById('stats');

    function log(msg) {
      logDiv.innerHTML += `<div>${msg}</div>`;
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }

    function generateEnemies(level) {
      const basePlayer = 5;
      const numberOfEnemies = 5 + Math.floor(level / 2);
      const path = [];
      let currentStrength = basePlayer;

      for (let i = 0; i < numberOfEnemies; i++) {
        const enemyStrength = Math.round(Math.floor(Math.random() * 3) + Math.floor(currentStrength * 0.5));
        path.push({ id: i + 1, type: 'enemy', level: enemyStrength });
        currentStrength += enemyStrength;
      }

      let x2Added = false;

      if (Math.random() < 0.6) {
        const bonusIndex = Math.floor(Math.random() * path.length);
        path.splice(bonusIndex, 0, { id: 'x2', type: 'item', effect: 'x2', required: true });
        x2Added = true;
      }
      if (Math.random() < 0.4) {
        path.splice(Math.floor(Math.random() * path.length), 0, { id: 'minus5', type: 'item', effect: '-5', required: true });
      }
      if (Math.random() < 0.3) {
        path.splice(Math.floor(Math.random() * path.length), 0, { id: 'random', type: 'item', effect: 'random', required: false });
      }

      if (x2Added) {
        const maxEnemy = { id: 'boss', type: 'enemy', level: Math.round(currentStrength * 1.5 + Math.floor(Math.random() * 10)) };
        path.push(maxEnemy);
      }

      shuffleArray(path);
      return path;
    }

    function render() {
      gameDiv.innerHTML = '';
      enemies.forEach(enemy => {
        const div = document.createElement('div');
        div.className = enemy.type === 'enemy' ? 'enemy' : 'item';
        if (enemy.defeated) div.classList.add('dead');
        if (enemy.type === 'enemy') {
          div.textContent = `Gegner\nStärke ${enemy.level}`;
          div.title = 'Greife nur an, wenn du stärker bist!';
          div.onclick = () => fight(enemy);
        } else if (enemy.type === 'item') {
          if (enemy.effect === 'x2') {
            div.classList.add('x2');
            div.textContent = 'Bonus x2';
            div.title = 'Verdoppelt deine aktuelle Stärke';
            div.onclick = () => {
              log(`Du sammelst Bonus x2! Deine Stärke verdoppelt sich.`);
              playerLevel *= 2;
              enemy.defeated = true;
              stats.bonusGenutzt++;
              render();
              checkLevelComplete();
            };
          } else if (enemy.effect === '-5') {
            div.classList.add('minus5');
            div.textContent = '-5 Falle';
            div.title = 'Verringert deine Stärke um 5';
            div.onclick = () => {
              if (playerLevel <= 5) {
                log(`Du verlierst 5 Stärke, aber hattest nur ${playerLevel}. Du verlierst.`);
                alert("Game Over!");
                location.reload();
                return;
              }
              log(`Du trittst in eine Falle! -5 Stärke.`);
              playerLevel -= 5;
              stats.fallenGetroffen++;
              enemy.defeated = true;
              render();
              checkLevelComplete();
            };
          } else if (enemy.effect === 'random') {
            div.classList.add('random');
            div.textContent = 'Zufall';
            div.title = 'Kann deine Stärke ändern – positiv, negativ oder gar nicht';
            div.onclick = () => {
              const rnd = Math.random();
              stats.zufallGenutzt++;
              if (rnd < 0.33) {
                log(`Zufall! Deine Stärke wird halbiert.`);
                playerLevel = Math.floor(playerLevel / 2);
              } else if (rnd < 0.66) {
                const gain = Math.floor(Math.random() * 10 + 1);
                log(`Zufall! Du bekommst ${gain} Stärke dazu.`);
                playerLevel += gain;
              } else {
                log(`Zufall! Nichts passiert.`);
              }
              enemy.defeated = true;
              render();
              checkLevelComplete();
            };
          }
        }
        gameDiv.appendChild(div);
      });
      playerLevelSpan.textContent = playerLevel;
      levelNumberSpan.textContent = level;
    }

    function fight(enemy) {
      if (enemy.defeated) return;
      if (playerLevel > enemy.level) {
        log(`Du besiegst Gegner mit Stärke ${enemy.level}.`);
        playerLevel += enemy.level;
        enemy.defeated = true;
        render();
        checkLevelComplete();
      } else {
        log(`Gegner mit Stärke ${enemy.level} ist zu stark oder gleich stark! Du verlierst.`);
        alert("Game Over!\n\nAbgeschlossene Level: " + stats.levelBeendet + "\nVerwendete x2-Boni: " + stats.bonusGenutzt + "\nGefallene Fallen: " + stats.fallenGetroffen + "\nZufall ausgelöst: " + stats.zufallGenutzt);
        location.reload();
      }
    }

    function checkLevelComplete() {
      const remaining = enemies.filter(e => !e.defeated);
      const allDone = remaining.every(e => e.type === 'item' && e.effect === 'random' && !e.required);
      if (remaining.length === 0 || allDone) {
        log(`<strong>Level ${level} abgeschlossen!</strong>`);
        stats.levelBeendet++;
        updateStats();
        nextLevelBtn.style.display = 'inline-block';
      }
    }

    function updateStats() {
      statsDiv.innerHTML = `
        <strong>Statistik:</strong><br>
        Abgeschlossene Level: ${stats.levelBeendet}<br>
        Verwendete x2-Boni: ${stats.bonusGenutzt}<br>
        Gefallene Fallen: ${stats.fallenGetroffen}<br>
        Zufall ausgelöst: ${stats.zufallGenutzt}<br>
      `;
    }

    function startLevel() {
      playerLevel = 5;
      enemies = generateEnemies(level);
      nextLevelBtn.style.display = 'none';
      log(`<em>Level ${level} beginnt.</em>`);
      render();
    }

    nextLevelBtn.onclick = () => {
      level++;
      startLevel();
    }

    // Start bei Level 1
    startLevel();
  </script></body>
</html>
