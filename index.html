<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>St√§rke Merge Battle</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #1e1e2f;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding-top: 20px;
    }
    h1, h2, h3 {
      margin: 5px;
    }
    #game {
      display: flex;
      gap: 15px;
      margin: 20px 0;
      flex-wrap: wrap;
      justify-content: center;
    }
    .enemy, .item, .boss {
      background: #333;
      padding: 20px;
      border-radius: 10px;
      cursor: pointer;
      text-align: center;
      transition: transform 0.2s;
      width: 100px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
    .enemy:hover, .item:hover, .boss:hover {
      transform: scale(1.1);
      background: #444;
    }
    .dead {
      opacity: 0.4;
      pointer-events: none;
    }
    .x2 { background: #2e8b57; color: #fff; font-weight: bold; }
    .minus5 { background: #8b0000; color: #fff; font-weight: bold; }
    .random { background: #1e90ff; color: #fff; font-weight: bold; }
    .boss { background: #ff8c00; color: black; font-weight: bold; border: 2px solid gold; }
    #log {
      max-height: 200px;
      overflow-y: auto;
      background: #111;
      padding: 10px;
      width: 300px;
      border-radius: 5px;
      box-shadow: inset 0 0 10px #000;
    }
    button {
      margin-top: 10px;
      padding: 10px 20px;
      border: none;
      background: #444;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      box-shadow: 0 0 5px rgba(255,255,255,0.2);
    }
    button:hover {
      background: #666;
    }
    #stats {
      margin-top: 20px;
      color: #ccc;
    }
  </style>
</head>
<body>
  <h1>St√§rke Merge Battle</h1>
  <h2>Level: <span id="levelNumber">1</span></h2>
  <h3 id="debuffText"></h3>
  <p>Deine St√§rke: <span id="playerLevel">5</span></p>
  <div id="game"></div>
  <div id="log"></div>
  <button id="nextLevelBtn" style="display:none;">N√§chstes Level starten</button>
  <div id="stats"></div>  <script>
    let level = 1;
    let playerLevel = 5;
    let basePlayerLevel = 5;
    let debuff = 0;
    let enemies = [];
    let bossMode = false;
    let bossPhase = 0;
    let bossTargetLevel = Math.floor(Math.random() * 10) + 1;

    let stats = {
      levelBeendet: 0,
      powerupsGenutzt: 0,
      fallenGetroffen: 0,
      zufallGenutzt: 0,
      bosseBesiegt: 0
    };

    const gameDiv = document.getElementById('game');
    const playerLevelSpan = document.getElementById('playerLevel');
    const logDiv = document.getElementById('log');
    const levelNumberSpan = document.getElementById('levelNumber');
    const nextLevelBtn = document.getElementById('nextLevelBtn');
    const statsDiv = document.getElementById('stats');
    const debuffText = document.getElementById('debuffText');

    function log(msg) {
      logDiv.innerHTML += `<div>${msg}</div>`;
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }

    function generateBossWave() {
      const phaseCount = Math.floor(Math.random() * 3) + 3;
      const wave = [];
      if (bossPhase < phaseCount - 1) {
        const count = 3 + Math.floor(Math.random() * 3);
        for (let i = 0; i < count; i++) {
          wave.push({ type: 'enemy', level: Math.floor(playerLevel * 0.7 + Math.random() * 5) });
        }
        bossPhase++;
      } else {
        const bossStrength = Math.floor(playerLevel * 1.3 + 10);
        wave.push({ type: 'boss', level: bossStrength });
        log(`<strong>‚öîÔ∏è Der Boss erscheint! St√§rke ${bossStrength}</strong>`);
        bossMode = false;
      }
      wave.forEach((e, i) => e.id = `b${bossPhase}-${i}`);
      return wave;
    }

    function generateEnemies(level) {
      let enemies = [
        { type: 'enemy', level: 4 },
        { type: 'enemy', level: 11 },
        { type: 'enemy', level: 34 },
        { type: 'enemy', level: 8 },
        { type: 'item', effect: 'x2', required: false },
      ];
      if (Math.random() < 0.4) enemies.push({ type: 'item', effect: '-5', required: true });
      if (Math.random() < 0.3) enemies.push({ type: 'item', effect: 'random', required: false });
      shuffleArray(enemies);
      enemies.forEach((e, i) => e.id = i);
      return enemies;
    }

    function render() {
      gameDiv.innerHTML = '';
      enemies.forEach(enemy => {
        const div = document.createElement('div');
        div.className = enemy.type;
        if (enemy.defeated) div.classList.add('dead');

        if (enemy.type === 'enemy') {
          div.textContent = `Gegner\nSt√§rke ${enemy.level}`;
          div.title = 'Greife nur an, wenn du st√§rker bist!';
          div.onclick = () => fight(enemy);
        }

        if (enemy.type === 'boss') {
          div.textContent = `üß† BOSS\nSt√§rke ${enemy.level}`;
          div.title = 'Endgegner ‚Äì kalkuliere gut!';
          div.onclick = () => fight(enemy);
        }

        if (enemy.type === 'item') {
          if (enemy.effect === 'x2') {
            div.classList.add('x2');
            div.textContent = 'Powerup x2';
            div.title = 'Verdoppelt deine aktuelle St√§rke';
            div.onclick = () => {
              log(`Du aktivierst Powerup x2! Deine St√§rke verdoppelt sich.`);
              playerLevel *= 2;
              enemy.defeated = true;
              stats.powerupsGenutzt++;
              render();
              checkLevelComplete();
            };
          }
          if (enemy.effect === '-5') {
            div.classList.add('minus5');
            div.textContent = '-5 Falle';
            div.title = 'Verliere 5 St√§rke';
            div.onclick = () => {
              if (playerLevel <= 5) {
                log(`-5 bei St√§rke ${playerLevel} = Game Over`);
                enemy.defeated = true;
                alert("Game Over!");
                location.reload();
                return;
              }
              playerLevel -= 5;
              log(`Falle ausgel√∂st! St√§rke -5.`);
              stats.fallenGetroffen++;
              enemy.defeated = true;
              render();
              checkLevelComplete();
            };
          }
          if (enemy.effect === 'random') {
            div.classList.add('random');
            div.textContent = 'Zufall';
            div.title = 'Zuf√§lliger Effekt';
            div.onclick = () => {
              stats.zufallGenutzt++;
              const rnd = Math.random();
              if (rnd < 0.33) {
                playerLevel = Math.floor(playerLevel / 2);
                log(`Zufall: St√§rke halbiert!`);
              } else if (rnd < 0.66) {
                const plus = Math.floor(Math.random() * 10 + 1);
                playerLevel += plus;
                log(`Zufall: St√§rke +${plus}`);
              } else {
                log(`Zufall: nichts passiert.`);
              }
              enemy.defeated = true;
              render();
              checkLevelComplete();
            };
          }
        }

        gameDiv.appendChild(div);
      });
      playerLevelSpan.textContent = playerLevel;
      levelNumberSpan.textContent = level;
      debuffText.textContent = debuff > 0 ? `üß® Ersch√∂pfung x${debuff} ‚Äì du startest mit ${basePlayerLevel - debuff}` : '';
    }

    function fight(enemy) {
      if (playerLevel > enemy.level) {
        log(`Du besiegst ${enemy.type === 'boss' ? 'den Boss' : 'Gegner'} St√§rke ${enemy.level}`);
        playerLevel += enemy.level;
        enemy.defeated = true;

        if (enemy.type === 'boss') {
          log(`<strong>‚úÖ Boss besiegt! Debuff aufgehoben.</strong>`);
          debuff = 0;
          stats.bosseBesiegt++;
        }

        render();
        checkLevelComplete();
      } else {
        if (enemy.type === 'boss') {
          debuff = Math.min(debuff + 1, 5);
          log(`<strong>‚ö†Ô∏è Du hast den Boss nicht besiegt. Ersch√∂pfung +1!</strong>`);
          checkLevelComplete();
        } else {
          log(`Verloren gegen Gegner St√§rke ${enemy.level}`);
          alert("Game Over");
          location.reload();
        }
      }
    }

    function checkLevelComplete() {
      const remaining = enemies.filter(e => !e.defeated);
      const allDone = remaining.every(e => e.type === 'item' && e.effect === 'random');
      if (remaining.length === 0 || allDone) {
        if (bossMode) {
          enemies = generateBossWave();
          render();
          return;
        }
        log(`<strong>Level ${level} geschafft!</strong>`);
        stats.levelBeendet++;
        nextLevelBtn.style.display = 'inline-block';
        updateStats();
      }
    }

    function updateStats() {
      statsDiv.innerHTML = `
        <strong>Statistik:</strong><br>
        Level beendet: ${stats.levelBeendet}<br>
        Powerups genutzt: ${stats.powerupsGenutzt}<br>
        Fallen getroffen: ${stats.fallenGetroffen}<br>
        Zufall benutzt: ${stats.zufallGenutzt}<br>
        Bosse besiegt: ${stats.bosseBesiegt}<br>
      `;
    }

    function startLevel() {
      playerLevel = basePlayerLevel - debuff;
      nextLevelBtn.style.display = 'none';
      bossPhase = 0;
      if ((level - 1) % 10 === bossTargetLevel - 1) {
        log(`<strong>‚öîÔ∏è Bosskampf beginnt!</strong>`);
        bossMode = true;
        enemies = generateBossWave();
      } else {
        enemies = generateEnemies(level);
      }
      render();
    }

    nextLevelBtn.onclick = () => {
      level++;
      startLevel();
    };

    startLevel();
  </script></body>
</html>
